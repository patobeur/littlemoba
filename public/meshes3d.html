<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<title>Vue des ModÃ¨les 3D</title>
		<style>
			body {
				margin: 0;
			}

			canvas {
				display: block;
			}
		</style>
		<script type="importmap">
			{
				"imports": {
					"three": "/node_modules/three/build/three.module.js",
					"three/examples/jsm/loaders/FBXLoader.js": "/node_modules/three/examples/jsm/loaders/FBXLoader.js",
					"three/examples/jsm/loaders/GLTFLoader.js": "/node_modules/three/examples/jsm/loaders/GLTFLoader.js",
					"three/examples/jsm/controls/OrbitControls.js": "/node_modules/three/examples/jsm/controls/OrbitControls.js"
				}
			}
		</script>
	</head>

	<body>
		<link rel="stylesheet" href="css/navbar.css" />
		<div class="main-navbar">
			<div class="nav-left">
				<a href="/lobby.html" class="nav-brand">
					ðŸŽ® <span>LittleMoba</span>
				</a>
				<div class="nav-links">
					<div class="nav-dropdown">
						<button class="nav-dropbtn">Minions â–¾</button>
						<div class="nav-dropdown-content">
							<a href="/meshes3d.html">Voir les modÃ¨les</a>
						</div>
					</div>
				</div>
			</div>
			<div class="nav-right">
				<div class="nav-user-info">
					ðŸ‘¤
					<span class="nav-username" id="navUsername">Chargement...</span>
				</div>
				<button class="nav-btn nav-btn-secondary" id="navLogoutBtn"
					>DÃ©connexion</button
				>
			</div>
		</div>
		<script src="js/navbar.js"></script>
		<script type="module">
			import * as THREE from "three";
			import { FBXLoader } from "three/examples/jsm/loaders/FBXLoader.js";
			import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader.js";
			import { OrbitControls } from "three/examples/jsm/controls/OrbitControls.js";

			let scene, camera, renderer, controls;
			const models = [];

			const files = {
				minion_mage_blue: {
					path: "/media/minions/glb/minion_mage_blue.fbx",
				},
				minion_tank_blue: {
					path: "/media/minions/glb/minion_tank_blue.fbx",
				},
				minion_healer_blue: {
					path: "/media/minions/glb/minion_healer_blue.fbx",
				},
				//-----
				minion_mage_red: { path: "/media/minions/glb/minion_mage_red.fbx" },
				minion_tank_red: {
					path: "/media/minions/glb/minion_tank_red_Idle.fbx",
				},
				minion_healer_red: {
					path: "/media/minions/glb/minion_healer_red.fbx",
				},
				// -----------
				X_Bot: { path: "/media/characters/glb/X_Bot.fbx" },
				Y_Bot: { path: "/media/characters/glb/Y_Bot.fbx" },
				// -----------
				baseTeamB: { path: "/media/structures/glb/baseTeamB.glb" },
				baseTeamA: { path: "/media/structures/glb/baseTeamA.glb" },
				// -----------
				Flora: { path: "/media/characters/glb/Flora.gltf" },
				Gromp: { path: "/media/characters/glb/Gromp.gltf" },
				Moonba: { path: "/media/characters/glb/Moonba.gltf" },
				Shadow: { path: "/media/characters/glb/Shadow.gltf" },
				Squazzzza: { path: "/media/characters/glb/Squazzzza.gltf" },
				Wiko: { path: "/media/characters/glb/Wiko.gltf" },
				Zephyr: { path: "/media/characters/glb/Zephyr.gltf" },
			}; // gltf

			function init() {
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0xdddddd);

				camera = new THREE.PerspectiveCamera(
					75,
					window.innerWidth / window.innerHeight,
					0.1,
					1000
				);
				camera.position.set(0, 2, 8);

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				controls = new OrbitControls(camera, renderer.domElement);

				const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
				scene.add(ambientLight);

				const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
				directionalLight.position.set(5, 10, 7.5);
				scene.add(directionalLight);

				loadModels();
				animate();
			}

			function loadModels() {
				const fbxLoader = new FBXLoader();
				const gltfLoader = new GLTFLoader();
				const modelEntries = Object.values(files);
				const numModels = modelEntries.length;
				const modelsPerRow = 3;
				const spacing = 2;

				modelEntries.forEach((file, index) => {
					const isFbx = file.path.toLowerCase().endsWith(".fbx");
					const isGltf = file.path.toLowerCase().endsWith(".gltf");
					const loader = isFbx ? fbxLoader : gltfLoader;

					loader.load(
						file.path,
						(object) => {
							const model = isFbx ? object : object.scene;

							const row = Math.floor(index / modelsPerRow);
							const col = index % modelsPerRow;

							model.position.set(
								(col - (modelsPerRow - 1) / 2) * spacing,
								0,
								-row * spacing
							);

							if (isFbx) {
								model.scale.set(0.01, 0.01, 0.01);
							} else if (isGltf) {
								model.scale.set(0.5, 0.5, 0.5);
							} else {
								// GLB models might not need scaling, or different scaling
								model.scale.set(1, 1, 1);
							}

							scene.add(model);
							console.log(model);
							models.push(model);
						},
						undefined,
						(error) => {
							console.error(
								`An error happened while loading ${file.path}:`,
								error
							);
						}
					);
				});
			}

			function animate() {
				requestAnimationFrame(animate);
				models.forEach((model) => {
					model.rotation.y += 0.005;
				});
				controls.update();
				renderer.render(scene, camera);
			}

			window.addEventListener("resize", () => {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			});

			init();
		</script>
	</body>
</html>
